<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Policy & Terms Generator — v2 (Jurisdiction Fix)</title>

<!-- PDF export libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071126;
    --card: rgba(255,255,255,0.03);
    --accent1:#7c3aed;
    --accent2:#06b6d4;
    --muted:#9fb0c8;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:
    radial-gradient(800px 400px at 10% 10%, rgba(124,58,237,0.07), transparent 8%),
    radial-gradient(700px 350px at 90% 90%, rgba(6,182,212,0.05), transparent 10%),
    var(--bg); color:#e6eef8; -webkit-font-smoothing:antialiased;}
  .wrap{max-width:1200px;margin:28px auto;padding:20px;border-radius:14px;
    display:grid; gap:18px; grid-template-columns: 380px 1fr; align-items:start;}
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 8px 24px rgba(2,6,23,0.45);
  }
  h1{margin:0;font-size:20px}
  .muted{color:var(--muted);font-size:13px;margin-top:6px}
  label{display:block;margin-top:12px;font-size:13px;color:var(--muted)}
  input[type="text"], input[type="email"], textarea, select {
    width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);
    background:rgba(255,255,255,0.02); color:inherit; box-sizing:border-box; margin-top:6px;
  }
  textarea{min-height:72px; resize:vertical}
  .row{display:flex;gap:8px}
  .btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .small{font-size:12px;color:var(--muted)}
  .saved-list{margin-top:12px;max-height:220px;overflow:auto;padding-right:6px}
  .saved-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;margin-top:8px;background:linear-gradient(180deg, rgba(255,255,255,0.008), transparent);border:1px solid rgba(255,255,255,0.02)}
  .preview-wrap{display:flex;flex-direction:column;gap:12px}
  .document{background:white;color:#111;padding:28px;border-radius:10px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}
  .doc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
  .doc-title{font-size:18px;font-weight:800}
  .section{margin-top:16px}
  .section h3{margin:0 0 8px 0;color:#0f1724;font-size:16px}
  .section p{margin:0;color:#223}
  .footer-small{font-size:12px;color:#596173;margin-top:20px}
  @media (max-width:980px){ .wrap{grid-template-columns:1fr;padding:14px} }
  input:focus, textarea:focus, select:focus { outline: 2px solid rgba(124,58,237,0.18); box-shadow: 0 6px 18px rgba(124,58,237,0.06) }
</style>
</head>
<body>
  <div class="wrap">
    <!-- LEFT: form -->
    <div class="panel" id="editorPanel">
      <h1>Policy & Terms Builder</h1>
      <div class="muted">All fields are blank by default. Type your values and click Generate.</div>

      <label for="company">Company / Site Name</label>
      <input id="company" type="text" placeholder="Your company or site name">

      <label for="siteUrl">Website URL</label>
      <input id="siteUrl" type="text" placeholder="https://example.com">

      <label for="contactEmail">Contact Email</label>
      <input id="contactEmail" type="email" placeholder="privacy@example.com">

      <label for="jurisdiction">Headquarters / Jurisdiction</label>
      <input id="jurisdiction" type="text" placeholder="e.g. Delaware, USA">

      <label for="services">Services / What you do</label>
      <input id="services" type="text" placeholder="e.g. SaaS project management">

      <label for="dataCollected">Data Collected (comma-separated)</label>
      <input id="dataCollected" type="text" placeholder="name, email, usage data">

      <label for="thirdParties">Third Parties / Integrations</label>
      <input id="thirdParties" type="text" placeholder="Stripe, Google Analytics">

      <label for="retention">Retention Policy</label>
      <input id="retention" type="text" placeholder="We retain data for X years">

      <label for="effectiveDate">Effective Date</label>
      <input id="effectiveDate" type="text" placeholder="YYYY-MM-DD">

      <label for="tone">Tone / Style</label>
      <select id="tone">
        <option value="professional">Professional</option>
        <option value="friendly">Friendly</option>
        <option value="minimal">Minimal</option>
      </select>

      <div class="row" style="margin-top:12px">
        <button id="generateBtn" class="btn">Generate</button>
        <button id="saveBtn" class="btn ghost">Save Template</button>
      </div>

      <label class="small" style="margin-top:12px">Shareable link</label>
      <div style="display:flex;gap:8px;margin-top:6px">
        <input id="shareLink" type="text" style="flex:1" readonly>
        <button id="copyLinkBtn" class="btn ghost">Copy</button>
      </div>

      <label class="small" style="margin-top:12px">Saved templates</label>
      <div class="saved-list" id="savedList"></div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="exportJsonBtn" class="btn ghost">Export JSON</button>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button id="importJsonBtn" class="btn ghost">Import JSON</button>
        <button id="clearAllBtn" class="btn ghost">Clear All</button>
      </div>
    </div>

    <!-- RIGHT: preview -->
    <div class="panel preview-wrap">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Preview</strong>
        <div style="display:flex;gap:8px">
          <button id="downloadHtmlBtn" class="btn ghost">Download HTML</button>
          <button id="downloadPdfBtn" class="btn">Download PDF</button>
        </div>
      </div>

      <div id="renderArea" class="document" aria-live="polite">
        <div class="doc-header">
          <div>
            <div class="doc-title" id="docCompany"></div>
            <div class="small" id="docUrl"></div>
          </div>
          <div class="small">Effective: <span id="docDate"></span></div>
        </div>

        <h2>Privacy Policy</h2>
        <p id="ppIntro"></p>

        <div class="section"><h3>What we collect</h3><p id="ppCollect"></p></div>
        <div class="section"><h3>How we use your data</h3><p id="ppUse"></p></div>
        <div class="section"><h3>Third parties</h3><p id="ppThird"></p></div>
        <div class="section"><h3>Data retention</h3><p id="ppRetention"></p></div>
        <div class="section"><h3>Your rights</h3><p id="ppRights"></p></div>
        <div class="section"><h3>Applicable law</h3><p id="ppLaw"></p></div>

        <hr style="margin:18px 0;border:none;border-top:1px solid #eee">

        <h2>Terms of Service</h2>
        <p id="tsIntro"></p>

        <div class="section"><h3>Acceptance</h3><p id="tsAcceptance"></p></div>
        <div class="section"><h3>Accounts & Access</h3><p id="tsAccounts"></p></div>
        <div class="section"><h3>Payment & Refunds</h3><p id="tsPayment"></p></div>
        <div class="section"><h3>Liability</h3><p id="tsLiability"></p></div>
        <div class="section"><h3>Contact & Governing Law</h3><p id="tsContact"></p></div>

        <div class="footer-small"></div>
      </div>
    </div>
  </div>

<script>
/* Utilities */
const qs = id => document.getElementById(id);
const fields = ['company','siteUrl','contactEmail','jurisdiction','services','dataCollected','thirdParties','retention','effectiveDate','tone'];

/* Build document using current inputs */
function generateDocument(){
  const s = {};
  fields.forEach(f=> s[f] = (qs(f).value || '').trim());
  // Values (no automatic non-user fills)
  const company = s.company || '';
  const site = s.siteUrl || '';
  const email = s.contactEmail || '';
  const jurisdiction = s.jurisdiction || '';
  const services = s.services || 'our services';
  const date = s.effectiveDate || '';

  // Compose privacy sections
  const dataCollected = s.dataCollected || 'Information you provide and usage data.';
  const thirdParties = s.thirdParties || '';
  const retention = s.retention || 'We retain data only as long as necessary per business and legal requirements.';

  const tone = s.tone || 'professional';
  const friendly = tone === 'friendly';

  qs('docCompany').textContent = company;
  qs('docUrl').textContent = site;
  qs('docDate').textContent = date || '—';

  qs('ppIntro').textContent = company
    ? `This Privacy Policy explains how ${company} collects and uses information when you use ${site || 'our services'}.`
    : `This Privacy Policy explains how we collect and use information when you use our services.`;

  qs('ppCollect').textContent = dataCollected;

  qs('ppUse').textContent = friendly
    ? `We use your information to operate ${services}, provide support, and improve your experience.`
    : `We use collected information to operate and provide ${services}, process requests, communicate with users, and for analytics and improvement purposes.`;

  qs('ppThird').textContent = thirdParties
    ? `We may share data with the following third parties and integrations: ${thirdParties}. We require partners to safeguard personal data.`
    : `We do not share personal data with third parties except where required to provide the Services or by law.`;

  qs('ppRetention').textContent = retention;

  qs('ppRights').textContent = email
    ? `You may contact ${email} to access, correct, or request deletion of your personal data. We will respond in accordance with applicable law.`
    : `You may contact us to request access, correction, or deletion of your personal data.`;

  qs('ppLaw').textContent = jurisdiction
    ? `This Privacy Policy is governed by the laws of ${jurisdiction}.`
    : `This Privacy Policy is governed by the applicable laws where we operate.`;

  // Terms
  qs('tsIntro').textContent = company
    ? `These Terms govern your use of services provided by ${company}.`
    : `These Terms govern your use of our services.`;

  qs('tsAcceptance').textContent = friendly
    ? `By using these services, you agree to the Terms above. Check the effective date for the current version.`
    : `By accessing and using the Services, you agree to these Terms. We may modify these Terms from time to time.`;

  qs('tsAccounts').textContent = `You are responsible for maintaining the confidentiality of your account credentials and for any activity that occurs under your account.`;

  qs('tsPayment').textContent = `If paid features apply, payment and refund terms will be provided at checkout.`;

  qs('tsLiability').textContent = `To the maximum extent permitted by law, ${company || 'The provider'} is not liable for indirect, incidental or consequential damages arising from the use of the Services.`;

  // Use jurisdiction in contact/gov law phrase
  if (email && jurisdiction) {
    qs('tsContact').textContent = `Questions about these Terms may be sent to ${email}. These Terms are governed by the laws of ${jurisdiction}.`;
  } else if (email) {
    qs('tsContact').textContent = `Questions about these Terms may be sent to ${email}.`;
  } else if (jurisdiction) {
    qs('tsContact').textContent = `These Terms are governed by the laws of ${jurisdiction}.`;
  } else {
    qs('tsContact').textContent = `Contact us for questions about these Terms.`;
  }

  // Share link (encode inputs in hash)
  const payload = {};
  fields.forEach(f=> payload[f] = s[f] || '');
  try {
    const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
    qs('shareLink').value = `${location.origin}${location.pathname}#${encoded}`;
  } catch(e) {
    qs('shareLink').value = '';
  }
}

/* Live generation while typing (debounced) */
let typingTimer;
function scheduleGenerate(){
  clearTimeout(typingTimer);
  typingTimer = setTimeout(generateDocument, 600);
}
fields.forEach(f => qs(f).addEventListener('input', scheduleGenerate));
qs('generateBtn').addEventListener('click', generateDocument);

/* Save / Load templates (localStorage) */
function loadSaved(){
  const container = qs('savedList');
  container.innerHTML = '';
  const keys = Object.keys(localStorage).filter(k=>k.startsWith('ptpl:')).sort().reverse();
  keys.forEach(key=>{
    try {
      const obj = JSON.parse(localStorage.getItem(key));
      const label = obj.company || obj.siteUrl || key;
      const div = document.createElement('div'); div.className = 'saved-item';
      const left = document.createElement('div'); left.innerHTML = `<strong>${label}</strong><div class="small">${obj.effectiveDate||''}</div>`;
      const right = document.createElement('div');
      right.innerHTML = `<button class="btn ghost" onclick='loadTemplate("${key}")'>Load</button> <button class="btn ghost" onclick='deleteTemplate("${key}")'>Delete</button>`;
      div.appendChild(left); div.appendChild(right);
      container.appendChild(div);
    } catch(e){ console.warn('bad template', key); }
  });
}
loadSaved();

qs('saveBtn').addEventListener('click', ()=>{
  const obj = {};
  fields.forEach(f=> obj[f] = qs(f).value || '');
  const key = `ptpl:${(qs('company').value||'template').replace(/\s+/g,'_')}:${Date.now()}`;
  localStorage.setItem(key, JSON.stringify(obj));
  loadSaved();
  alert('Template saved locally.');
});

window.loadTemplate = function(key){
  try {
    const obj = JSON.parse(localStorage.getItem(key));
    fields.forEach(f=> qs(f).value = obj[f] || '');
    generateDocument();
    alert('Template loaded.');
  } catch(e) { alert('Failed to load template.'); }
};
window.deleteTemplate = function(key){
  if(confirm('Delete this template?')) { localStorage.removeItem(key); loadSaved(); }
};

/* Export / Import JSON */
qs('exportJsonBtn').addEventListener('click', ()=>{
  const obj = {}; fields.forEach(f=> obj[f] = qs(f).value || '');
  const blob = new Blob([JSON.stringify(obj, null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'policy-template.json'; a.click();
});
qs('importJsonBtn').addEventListener('click', ()=> qs('importFile').click());
qs('importFile').addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ()=> {
    try {
      const obj = JSON.parse(r.result);
      fields.forEach(ff => qs(ff).value = obj[ff] || '');
      generateDocument();
      alert('Imported template.');
    } catch(err) { alert('Invalid JSON file.'); }
  };
  r.readAsText(f);
});

/* Copy share link */
qs('copyLinkBtn').addEventListener('click', ()=>{
  if (!qs('shareLink').value) { alert('Generate first to create a link.'); return; }
  navigator.clipboard.writeText(qs('shareLink').value).then(()=> alert('Link copied to clipboard.'));
});

/* Download HTML */
qs('downloadHtmlBtn').addEventListener('click', ()=>{
  const title = (qs('company').value || 'policies').replace(/\s+/g,'_').toLowerCase();
  const docHtml = `<!doctype html><html><head><meta charset="utf-8"><title>${qs('company').value||'Policies'}</title><meta name="viewport" content="width=device-width,initial-scale=1"><style>body{font-family:Inter,system-ui,Arial,sans-serif;padding:28px;color:#111;background:#f7fafc}.doc{max-width:780px;margin:0 auto;background:white;padding:28px;border-radius:10px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}h1,h2,h3{color:#0b1220} p{color:#243040}</style></head><body><div class="doc">${qs('renderArea').innerHTML}</div></body></html>`;
  const blob = new Blob([docHtml], {type:'text/html'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${title}_policies.html`; a.click();
});

/* Download PDF */
qs('downloadPdfBtn').addEventListener('click', async ()=>{
  qs('downloadPdfBtn').textContent = 'Rendering PDF…';
  try {
    const area = qs('renderArea');
    const canvas = await html2canvas(area, {scale:2, useCORS:true});
    const imgData = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({unit:'px', format:[canvas.width, canvas.height]});
    pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
    pdf.save(`${(qs('company').value||'policies')}_policies.pdf`);
  } catch(e) {
    console.error(e);
    alert('PDF export failed — try Download HTML instead.');
  } finally {
    qs('downloadPdfBtn').textContent = 'Download PDF';
  }
});

/* Clear all saved templates */
qs('clearAllBtn').addEventListener('click', ()=>{
  if(confirm('Clear all saved templates from localStorage?')) {
    Object.keys(localStorage).filter(k=>k.startsWith('ptpl:')).forEach(k=> localStorage.removeItem(k));
    loadSaved();
  }
});

/* Load from URL hash if present (on open) */
function loadFromHash(){
  if(location.hash && location.hash.length>1){
    try{
      const json = decodeURIComponent(atob(location.hash.slice(1)));
      const obj = JSON.parse(json);
      fields.forEach(f => { if(obj[f] !== undefined) qs(f).value = obj[f]; });
    } catch(e){ console.warn('Failed to load from hash', e); }
  }
}

/* Init */
(function init(){
  loadFromHash();
  generateDocument();
  loadSaved();
})();
</script>
</body>
</html>
